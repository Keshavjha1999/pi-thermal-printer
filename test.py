import serial
import adafruit_thermal_printer
from datetime import datetime
from datetime import date
import requests
from PIL import Image
# from ThermalPrinter import *

# Connection to the serial port
uart = serial.Serial("/dev/ttyS0", baudrate=9600, timeout=3000)

# Printer class defined as mentioned in the test page
ThermalPrinter = adafruit_thermal_printer.get_printer_class(2.69)

#Connection mode mentioned
printer = ThermalPrinter(uart)

#Today date and time
today = date.today()
data = ["0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0xff","0xff",
  "0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xe0","0xff","0xff",
  "0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff",
  "0xff","0xe0","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff",
  "0xff","0x1f","0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0xfc","0x07","0xff","0xff","0xff","0xe0",
  "0xff","0xff","0xff","0xff","0xf9","0xc3","0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0xe7","0xc1",
  "0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0xcf","0xc0","0xff","0xff","0xff","0xe0","0xff","0xff",
  "0xff","0xff","0xcf","0xc0","0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0xe0","0x00","0xff","0xff",
  "0xff","0xe0","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff",
  "0xff","0xff","0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0xc0","0x00","0x7f","0xff","0xff","0xe0",
  "0xff","0xff","0xff","0xff","0x9f","0x80","0x3f","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0xbf","0x80",
  "0x3f","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0x3f","0x80","0x3f","0xff","0xff","0xe0","0xff","0xff",
  "0xff","0xff","0x3f","0x80","0x3f","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0x80","0x00","0x3f","0xff",
  "0xff","0xe0","0xff","0xff","0xff","0xff","0xf8","0x47","0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff",
  "0xff","0xff","0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xfe","0x00","0x00","0x1f","0xff","0xff","0xe0",
  "0xff","0xff","0xff","0xf8","0x12","0x80","0x07","0xff","0xff","0xe0","0xff","0xff","0xff","0xf8","0xff","0x80",
  "0x03","0xff","0xff","0xe0","0xff","0xff","0xff","0xf1","0xff","0x80","0x03","0xff","0xff","0xe0","0xff","0xff",
  "0xff","0xf1","0xff","0x80","0x01","0xff","0xff","0xe0","0xff","0xff","0xff","0xf3","0xff","0x80","0x01","0xff",
  "0xff","0xe0","0xff","0xff","0xff","0xe3","0xff","0x80","0x00","0xff","0xff","0xe0","0xff","0xff","0xff","0xe3",
  "0xff","0x80","0x00","0xff","0xff","0xe0","0xff","0xff","0xff","0xe7","0xff","0x80","0x00","0xff","0xff","0xe0",
  "0xff","0xff","0xff","0xc7","0xff","0x80","0x00","0x7f","0xff","0xe0","0xff","0xff","0xff","0xcf","0xff","0x80",
  "0x00","0x7f","0xff","0xe0","0xff","0xff","0xff","0x8f","0xff","0x80","0x00","0x3f","0xff","0xe0","0xff","0xff",
  "0xff","0x9f","0xff","0x80","0x00","0x3f","0xff","0xe0","0xff","0xff","0xff","0x1f","0xff","0x80","0x00","0x1f",
  "0xff","0xe0","0xff","0xff","0xff","0x3f","0xff","0x80","0x00","0x0f","0xff","0xe0","0xff","0xff","0xfe","0x3f",
  "0xff","0x80","0x00","0x0f","0xff","0xe0","0xff","0xff","0xfc","0x7f","0xff","0x80","0x00","0x07","0xff","0xe0",
  "0xff","0xff","0xfc","0x7f","0xff","0x80","0x00","0x07","0xff","0xe0","0xff","0xff","0xf8","0xff","0xff","0x80",
  "0x00","0x03","0xff","0xe0","0xff","0xff","0xf8","0xff","0xff","0x80","0x00","0x03","0xff","0xe0","0xff","0xff",
  "0xf1","0xff","0xff","0x80","0x00","0x01","0xff","0xe0","0xff","0xff","0xf1","0xff","0xff","0x80","0x00","0x00",
  "0xff","0xe0","0xff","0xff","0xe3","0xff","0xff","0x80","0x00","0x00","0xff","0xe0","0xff","0xff","0xe3","0xff",
  "0xff","0x80","0x00","0x00","0xff","0xe0","0xff","0xff","0xe7","0xff","0xff","0x80","0x00","0x00","0x7f","0xe0",
  "0xff","0xff","0xc7","0xff","0xff","0x80","0x00","0x00","0x7f","0xe0","0xff","0xff","0xc7","0xff","0xff","0x80",
  "0x00","0x00","0x7f","0xe0","0xff","0xff","0xc7","0xff","0xff","0x80","0x00","0x00","0x7f","0xe0","0xff","0xff",
  "0xc7","0xff","0xff","0x80","0x00","0x00","0x7f","0xe0","0xff","0xff","0xc7","0xff","0xff","0x80","0x00","0x00",
  "0x7f","0xe0","0xff","0xff","0xc7","0xff","0xff","0x80","0x00","0x00","0x7f","0xe0","0xff","0xff","0xc7","0xff",
  "0xff","0x80","0x00","0x00","0x7f","0xe0","0xff","0xff","0xc7","0xff","0xff","0x80","0x00","0x00","0x7f","0xe0",
  "0xff","0xff","0xe3","0xff","0xff","0x80","0x00","0x00","0x7f","0xe0","0xff","0xff","0xe3","0xff","0xff","0x80",
  "0x00","0x00","0xff","0xe0","0xff","0xff","0xf3","0xff","0xff","0x80","0x00","0x00","0xff","0xe0","0xff","0xff",
  "0xf1","0xff","0xff","0x80","0x00","0x01","0xff","0xe0","0xff","0xff","0xf8","0xff","0xff","0x80","0x00","0x01",
  "0xff","0xe0","0xff","0xff","0xfc","0x7f","0xff","0x80","0x00","0x03","0xff","0xe0","0xff","0xff","0xfc","0x7f",
  "0xff","0x80","0x00","0x07","0xff","0xe0","0xff","0xff","0xfe","0x1f","0xff","0x80","0x00","0x0f","0xff","0xe0",
  "0xff","0xff","0xff","0x0f","0xff","0x80","0x00","0x1f","0xff","0xe0","0xff","0xff","0xff","0xc3","0xff","0x80",
  "0x00","0x3f","0xff","0xe0","0xff","0xff","0xff","0xe0","0xff","0x80","0x00","0xff","0xff","0xe0","0xff","0xff",
  "0xff","0xf8","0x3f","0x80","0x01","0xff","0xff","0xe0","0xff","0xff","0xff","0xfe","0x00","0x00","0x0f","0xff",
  "0xff","0xe0","0xff","0xff","0xff","0xff","0xc0","0x00","0x7f","0xff","0xff","0xe0","0xff","0xff","0xff","0xff",
  "0xff","0x1f","0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xe0",
  "0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0xff","0xff",
  "0xff","0xff","0xff","0xe0","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xff","0xe0"]


# if not printer.has_paper():
#     print("No paper. Please insert one roll")
# else:
# --------------------------------------------------------------------------------------
printer.bold = True
printer.justify = adafruit_thermal_printer.JUSTIFY_CENTER
printer.print("Sound Level Measurement")
printer.justify = adafruit_thermal_printer.JUSTIFY_LEFT
printer.feed(1)

# Equipment Name
printer.print("Equipment: SLM-04")
printer.print("^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^")
printer.feed(1)

#Date
d1 = today.strftime("%d/%m/%Y")
printer.print("Date: ", d1)
print("\n")
printer.feed(1)

#Time
now = datetime.now()

current_time = now.strftime("%H:%M:%S")
printer.print("Time: ", current_time)
print("\n")
printer.feed(1)

#Location Latitude and Longitude
# gps = GPS()

printer.print("Latitude: ")
printer.print("Longitude: ")

# Level of noise
printer.print("LEVEL: ")

# Signature
printer.print("Signature: ")
printer.feed(1)
printer.print("--------------------------------")
printer.feed(2)

printer.print_barcode('123456789012', printer.UPC_A)
printer.feed(5)

printer._print_bitmap(80, 88, data)
# printer.image(Image.open('insta_logo.png'))
# print((80//8)*88)
# print(len(data))
#------------------------------------------------------------------------------------------

# printer.test_page()